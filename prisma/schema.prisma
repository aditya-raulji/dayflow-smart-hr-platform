

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  EMPLOYEE
}

model Company {
  id          String   @id @default(cuid())
  name        String   @unique
  logo        String?  // URL or path to logo file
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  users       User[]   // All users (HR and employees) belonging to this company

  @@map("companies")
}

model User {
  id        String   @id @default(cuid())
  employeeId String? @unique  // Auto-generated Login ID for employees
  email     String   @unique
  password  String
  name      String
  phone     String?
  role      Role     @default(EMPLOYEE)
  
  companyId String?
  company   Company? @relation(fields: [companyId], references: [id])
  
  emailVerified Boolean  @default(false)
  verificationToken String?
  verificationTokenExpiry DateTime?
  
  // Profile relations
  profile       EmployeeProfile?
  jobDetails    JobDetails?
  salaryStructure SalaryStructure?
  documents     Document[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model EmployeeProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  profilePicture String?
  dateOfBirth    DateTime?
  gender          String?
  maritalStatus  String?
  nationality     String?
  personalEmail   String?
  residingAddress String?
  
  // About section
  about           String?
  jobLoves        String?
  interestsHobbies String?
  
  // Bank details
  accountNumber   String?
  bankName        String?
  ifscCode        String?
  panNumber       String?
  uanNumber       String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("employee_profiles")
}

model JobDetails {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  jobPosition String?
  department  String?
  manager     String?
  workLocation String?
  dateOfJoining DateTime?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("job_details")
}

model SalaryStructure {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Wage information
  monthlyWage     Float?
  yearlyWage      Float?
  workingDaysPerWeek Int?
  overtime        Float?
  
  // Salary components
  basicSalary           Float?
  basicSalaryPercent    Float?
  houseRentAllowance    Float?
  hraPercent            Float?
  standardAllowance     Float?
  performanceBonus      Float?
  performanceBonusPercent Float?
  leaveTravelAllowance  Float?
  ltaPercent            Float?
  fuelAllowance         Float?
  
  // PF Contribution
  employeePF            Float?
  employeePFPercent     Float?
  employerPF            Float?
  employerPFPercent     Float?
  
  // Tax Deductions
  professionalTax       Float?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("salary_structures")
}

model Document {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fileName    String
  fileType    String
  fileUrl     String
  documentType String? // Resume, Certificate, etc.
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("documents")
}
